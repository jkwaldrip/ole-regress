#!/usr/bin/env ruby
dir = File.expand_path(File.dirname(__FILE__) + '/../')
$:<< dir unless $:.include?(dir)

require 'rspec/expectations'
require 'rspec/matchers'
require 'lib/ole-regress.rb'
require 'csv'
require 'benchmark'

include OLE_QA::Profiler::Mixins
include OLE_QA::Profiler::Tests

FileUtils::mkdir('performance') unless File.directory?('performance')

csv_filename = "PerfomanceTest-#{Time.now.strftime('%Y-%m-%d-%I%M_%p')}.csv"

results = []
results << ['Test Name','Start Time','Total Test Time']

ole_start

puts "#{'Test Name'.ljust(45)} #{'Time Now'.ljust(15)} Time Elapsed"

5.times do
  test_name = 'Portal Tab Sprint'
  test_time = format_time(Benchmark.realtime {tab_sprint})
  time_now  = current_time
  puts "#{test_name.ljust(45)} #{time_now.ljust(15)} #{test_time}"
  results << [test_name,time_now,test_time]
end

5.times do
  test_name = 'Requisition Submission'
  test_time = format_time(Benchmark.realtime {submit_req})
  time_now  = current_time
  puts "#{test_name.ljust(45)} #{time_now.ljust(15)} #{test_time}"
  results << [test_name,time_now,test_time]
end

ole_stop

CSV.open("performance/#{csv_filename}",'wb') do |csv|
  results.each do |line|
    csv << line
  end
end
